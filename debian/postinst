#!/bin/sh

set -e

case "$1" in
    configure|upgrade                            )
        deb-systemd-helper unmask 'ddnsd.service' >/dev/null || true
        if deb-systemd-helper --quiet was-enabled 'ddnsd.service'; then
            deb-systemd-helper enable 'ddnsd.service' >/dev/null || true
        else
            deb-systemd-helper update-state 'ddnsd.service' >/dev/null || true
        fi

        # Reload systemd and start or restart services
        # shellcheck disable=SC2086
        if [ -d /run/systemd/system ]; then
            systemctl --system daemon-reload >/dev/null || true
            [ -n "$2" ] && _dh_action=restart || _dh_action=start
            deb-systemd-invoke $_dh_action 'ddnsd.service' >/dev/null || true
        fi

        if [ -f /etc/ddnsd.conf ]; then
            mv /etc/ddnsd.conf /etc/ddnsd/ddnsd.conf.old
        fi
    ;;
    failed-upgrade                               ) ;;
    abort-upgrade|abort-deconfigure|abort-remove ) ;;
    *                                            )
        echo "Unsupported option $1" ; exit 1
    ;;
esac
